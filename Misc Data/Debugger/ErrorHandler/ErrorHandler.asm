
; ===============================================================
; ---------------------------------------------------------------
; MD Debugger and Error Handler v.2.6
;
;
; Documentation, references and source code are available at:
; - https://github.com/vladikcomper/md-modules
;
; (c) 2016-2024, Vladikcomper
; ---------------------------------------------------------------
; Debugger and Error handler blob
; ---------------------------------------------------------------


; ---------------------------------------------------------------
; Exception vectors
; ---------------------------------------------------------------

	if DEBUGGER__SHOW_SR_USP
_eh_default:	equ	_eh_show_sr_usp
	else
_eh_default:	equ	0
	endif

; ---------------------------------------------------------------

BusError:
	__ErrorMessage "BUS ERROR", _eh_default|_eh_address_error

AddressError:
	__ErrorMessage "ADDRESS ERROR", _eh_default|_eh_address_error

IllegalInstr:
	__ErrorMessage "ILLEGAL INSTRUCTION", _eh_default

ZeroDivide:
	__ErrorMessage "ZERO DIVIDE", _eh_default

ChkInstr:
	__ErrorMessage "CHK INSTRUCTION", _eh_default

TrapvInstr:
	__ErrorMessage "TRAPV INSTRUCTION", _eh_default

PrivilegeViol:
	__ErrorMessage "PRIVILEGE VIOLATION", _eh_default

Trace:
	__ErrorMessage "TRACE", _eh_default

Line1010Emu:
	__ErrorMessage "LINE 1010 EMULATOR", _eh_default

Line1111Emu:
	__ErrorMessage "LINE 1111 EMULATOR", _eh_default

ErrorExcept:
	__ErrorMessage "ERROR EXCEPTION", _eh_default

ErrorTrap:
	__ErrorMessage "ERROR TRAP", _eh_default


; ---------------------------------------------------------------
; MD Debugger blob
; ---------------------------------------------------------------

ErrorHandler:

	dc.l	$46FC2700, $4FEFFFF0, $48E7FFFE, $4EBA0242, $49EF004C, $4E682F08, $47EF0040, $4EBA0124
	dc.l	$41FA02C4, $4EBA0B6C, $225C45D4, $4EBA0C2A, $4EBA0AF2, $49D21C19, $6A025249, $47D10806
	dc.l	$0000670E, $41FA02A7, $222C0002, $4EBA016A, $504C41FA, $02A4222C, $00024EBA, $015C0806
	dc.l	$00026614, $22780000, $45EC0006, $4EBA01BC, $41FA0290, $4EBA0142, $4EBA0AAA, $08060006
	dc.l	$660000AA, $45EF0004, $4EBA0A74, $3F017003, $4EBA0A38, $303C6430, $7A074EBA, $0132321F
	dc.l	$70114EBA, $0A26303C, $61307A06, $4EBA0120, $303C7370, $7A002F0C, $45D74EBA, $0112584F
	dc.l	$08060001, $671443FA, $025545D7, $4EBA0B8E, $43FA0256, $45D44EBA, $0B80584F, $4EBA0A20
	dc.l	$52417001, $4EBA09E4, $20380078, $41FA0244, $4EBA010A, $20380070, $41FA0240, $4EBA00FE
	dc.l	$4EBA0A22, $22780000, $45D45389, $61404EBA, $09EE7A19, $9A416B0A, $61484EBA, $005A51CD
	dc.l	$FFFA0806, $0005660A, $4E7160FC, $72004EBA, $0A222ECB, $4CDF7FFF, $487AFFEE, $2F2FFFC4
	dc.l	$4E7543FA, $015E45FA, $02084EFA, $08EE223C, $00FFFFFF, $2409C481, $2242240A, $C4812442
	dc.l	$4E754FEF, $FFD041D7, $7EFF20FC, $28535029, $30FC3A20, $60184FEF, $FFD041D7, $7EFF30FC
	dc.l	$202B320A, $924C4EBA, $05BA30FC, $3A207005, $72ECB5C9, $650272EE, $10C1321A, $4EBA05C2
	dc.l	$10FC0020, $51C8FFEA, $421841D7, $72004EBA, $09DC4FEF, $00304E75, $4EBA09D8, $2F012F01
	dc.l	$45D743FA
	dc.w	DEBUGGER__STR_OFFSET_SELECTOR-MDDBG__Error_DrawOffsetLocation__inj-2
	dc.l	$4EBA0A90, $504F4E75, $4FEFFFF0, $7EFF41D7, $30C030FC, $3A2010FC, $00EC221A, $4EBA0574
	dc.l	$421841D7, $72004EBA, $099E5240, $51CDFFE0, $4FEF0010, $4E752200, $48414601, $66F62440
	dc.l	$0C5A4EF9, $66042212, $60A80C6A, $4EF8FFFE, $66063212, $48C1609A, $4EBA0972, $41FA011E
	dc.l	$4EFA0966, $59894EBA, $FF20B3CA, $650C0C52, $0040650A, $548AB3CA, $64F47200, $4E752212
	dc.l	$67F20801, $000066EC, $4E754BF9, $00C00004, $4DEDFFFC, $44D569FC, $41FA0026, $30186A04
	dc.l	$3A8060F8, $70002ABC, $40000000, $2C802ABC, $40000010, $2C802ABC, $C0000000, $3C804E75
	dc.l	$80048134, $85008700, $8B008C81, $8D008F02, $90119100, $92008220, $84040000, $44000000
	dc.l	$00000001, $00100011, $01000101, $01100111, $10001001, $10101011, $11001101, $11101111
	dc.l	$FFFF0EEE, $FFF200CE, $FFF20EEA, $FFF20E86, $FFF24000, $00020028, $00280000, $008000FF
	dc.l	$EAE0FA01, $F02600EA, $41646472, $6573733A, $2000EA4F, $66667365, $743A2000, $EA43616C
	dc.l	$6C65723A, $2000EC80, $8120E8BF, $ECC800EC, $8320E8BF, $ECC800FA, $10E87573, $703A20EC
	dc.l	$8300FA03, $E873723A, $20EC8100, $EA56496E, $743A2000, $EA48496E, $743A2000, $E83C756E
	dc.l	$64656669, $6E65643E, $000002F7, $00000000, $00000000, $183C3C18, $18001800, $6C6C6C00
	dc.l	$00000000, $6C6CFE6C, $FE6C6C00, $187EC07C, $06FC1800, $00C60C18, $3060C600, $386C3876
	dc.l	$CCCC7600, $18183000, $00000000, $18306060, $60301800, $60301818, $18306000, $00EE7CFE
	dc.l	$7CEE0000, $0018187E, $18180000, $00000000, $18183000, $000000FE, $00000000, $00000000
	dc.l	$00383800, $060C1830, $60C08000, $7CC6CEDE, $F6E67C00, $18781818, $18187E00, $7CC60C18
	dc.l	$3066FE00, $7CC6063C, $06C67C00, $0C1C3C6C, $FE0C0C00, $FEC0FC06, $06C67C00, $7CC6C0FC
	dc.l	$C6C67C00, $FEC6060C, $18181800, $7CC6C67C, $C6C67C00, $7CC6C67E, $06C67C00, $001C1C00
	dc.l	$001C1C00, $00181800, $00181830, $0C183060, $30180C00, $0000FE00, $00FE0000, $6030180C
	dc.l	$18306000, $7CC6060C, $18001800, $7CC6C6DE, $DCC07E00, $386CC6C6, $FEC6C600, $FC66667C
	dc.l	$6666FC00, $3C66C0C0, $C0663C00, $F86C6666, $666CF800, $FEC2C0F8, $C0C2FE00, $FE62607C
	dc.l	$6060F000, $7CC6C0C0, $DEC67C00, $C6C6C6FE, $C6C6C600, $3C181818, $18183C00, $3C181818
	dc.l	$D8D87000, $C6CCD8F0, $D8CCC600, $F0606060, $6062FE00, $C6EEFED6, $D6C6C600, $C6E6E6F6
	dc.l	$DECEC600, $7CC6C6C6, $C6C67C00, $FC66667C, $6060F000, $7CC6C6C6, $C6D67C06, $FCC6C6FC
	dc.l	$D8CCC600, $7CC6C07C, $06C67C00, $7E5A1818, $18183C00, $C6C6C6C6, $C6C67C00, $C6C6C6C6
	dc.l	$6C381000, $C6C6D6D6, $FEEEC600, $C66C3838, $386CC600, $6666663C, $18183C00, $FE860C18
	dc.l	$3062FE00, $7C606060, $60607C00, $C0603018, $0C060200, $7C0C0C0C, $0C0C7C00, $10386CC6
	dc.l	$00000000, $00000000, $000000FF, $30301800, $00000000, $0000780C, $7CCC7E00, $E0607C66
	dc.l	$6666FC00, $00007CC6, $C0C67C00, $1C0C7CCC, $CCCC7E00, $00007CC6, $FEC07C00, $1C3630FC
	dc.l	$30307800, $000076CE, $C67E067C, $E0607C66, $6666E600, $18003818, $18183C00, $0C001C0C
	dc.l	$0C0CCC78, $E060666C, $786CE600, $18181818, $18181C00, $00006CFE, $D6D6C600, $0000DC66
	dc.l	$66666600, $00007CC6, $C6C67C00, $0000DC66, $667C60F0, $000076CC, $CC7C0C1E, $0000DC66
	dc.l	$6060F000, $00007CC0, $7C067C00, $3030FC30, $30361C00, $0000CCCC, $CCCC7600, $0000C6C6
	dc.l	$6C381000, $0000C6C6, $D6FE6C00, $0000C66C, $386CC600, $0000C6C6, $CE76067C, $0000FC98
	dc.l	$3064FC00, $0E181870, $18180E00, $18181800, $18181800, $7018180E, $18187000, $76DC0000
	dc.l	$00000000, $43FA090A, $0C59DEB2, $667270FE, $D05974FC, $76004841, $024100FF, $D241D241
	dc.l	$B240625C, $675E2031, $10006758, $47F10800, $48417000, $301BB253, $654C43F3, $08FE45E9
	dc.l	$FFFCE248, $C042B273, $00006514, $6204D6C0, $601A47F3, $0004200A, $908B6AE6, $594B600C
	dc.l	$45F300FC, $200A908B, $6AD847D2, $925B7400, $341BD3C2, $48414241, $4841D283, $70004E75
	dc.l	$70FF4E75, $48417000, $3001D680, $5283323C, $FFFF4841, $59416A8E, $70FF4E75, $47FA0872
	dc.l	$0C5BDEB2, $664AD6D3, $78007200, $740045D3, $51CC0006, $16197807, $D603D341, $5242B252
	dc.l	$620A65EC, $B42A0002, $671265E4, $584AB252, $62FA65DC, $B42A0002, $65D666F0, $10EA0003
	dc.l	$670A51CF, $FFC64E94, $64C04E75, $53484E75, $70004E75, $4EFA0024, $4EFA0018, $760F3401
	dc.l	$E84AC443, $10FB205C, $51CF004A, $4E946444, $4E754841, $61046548, $4841E959, $780FC841
	dc.l	$10FB4040, $51CF0006, $4E946534, $E959780F, $C84110FB, $402E51CF, $00064E94, $6522E959
	dc.l	$780FC841, $10FB401C, $51CF0006, $4E946510, $E959760F, $C24310FB, $100A51CF, $00044ED4
	dc.l	$4E753031, $32333435, $36373839, $41424344, $45464841, $67066106, $65E6609C, $4841E959
	dc.l	$780FC841, $670E10FB, $40DA51CF, $FFA04E94, $649A4E75, $E959780F, $C841670E, $10FB40C4
	dc.l	$51CFFF9C, $4E946496, $4E75E959, $780FC841, $679E10FB, $40AE51CF, $FF984E94, $64924E75
	dc.l	$4EFA0026, $4EFA001A, $74077018, $D201D100, $10C051CF, $00064E94, $650451CA, $FFEE4E75
	dc.l	$48416104, $65184841, $740F7018, $D241D100, $10C051CF, $00064E94, $650451CA, $FFEE4E75
	dc.l	$4EFA0010, $4EFA0048, $47FA009A, $024100FF, $600447FA, $008C4200, $7609381B, $34039244
	dc.l	$55CAFFFC, $D2449443, $44428002, $670E0602, $003010C2, $51CF0006, $4E946510, $381B6ADC
	dc.l	$06010030, $10C151CF, $00044ED4, $4E7547FA, $002E4200, $7609281B, $34039284, $55CAFFFC
	dc.l	$D2849443, $44428002, $670E0602, $003010C2, $51CF0006, $4E9465D4, $281B6ADC, $609E3B9A
	dc.l	$CA0005F5, $E1000098, $9680000F, $42400001, $86A00000, $2710FFFF, $03E80064, $000AFFFF
	dc.l	$271003E8, $0064000A, $FFFF48C1, $60084EFA, $00064881, $48C148E7, $50604EBA, $FD486618
	dc.l	$2E814EBA, $FDD84CDF, $060A650A, $08030003, $66044EFA, $00B64E75, $4CDF060A, $08030002
	dc.l	$670847FA, $000A4EFA, $00B470FF, $60DE3C75, $6E6B6E6F, $776E3E00, $10FC002B, $51CF0006
	dc.l	$4E9465D2, $48414A41, $6700FE72, $6000FE68, $08030003, $66C04EFA, $FDFA48E7, $F81010D9
	dc.l	$5FCFFFFC, $6E146718, $16207470, $C4034EBB, $201A64EA, $4CDF081F, $4E754E94, $64E060F4
	dc.l	$53484E94, $4CDF081F, $4E7547FA, $FDA8B702, $D4024EFB, $205A4E71, $4E7147FA, $FEA4B702
	dc.l	$D4024EFB, $204A4E71, $4E7147FA, $FE54B702, $D4024EFB, $203A5348, $4E7547FA, $FF2E7403
	dc.l	$C403D442, $4EFB2028, $4E714A40, $6B084A81, $67164EFA, $FF644EFA, $FF78265A, $10DB57CF
	dc.l	$FFFC67D2, $4E9464F4, $4E755248, $6032504B, $321A4ED3, $584B221A, $4ED35547, $6028504B
	dc.l	$321A6004, $584B221A, $6A084481, $10FC002D, $600410FC, $002B51CF, $00064E94, $65CA4ED3
	dc.l	$51CFFFC6, $4ED46506, $524810D9, $4E755447, $53494ED4, $4BF900C0, $00044DED, $FFFC4A51
	dc.l	$6B102A99, $41D23818, $4EBA023C, $43E90020, $60EC5449, $2ABCC000, $00007000, $76033C80
	dc.l	$34193C82, $34196AFA, $72004EBB, $204C51CB, $FFEE2A19, $200B4840, $024000FF, $00405D00
	dc.l	$48402640, $4E6326C5, $26C526D9, $26D92A85, $70003219, $61122ABC, $40000000, $72006108
	dc.l	$3ABC8174, $2A854E75, $2C802C80, $2C802C80, $2C802C80, $2C802C80, $51C9FFEE, $4E754CAF
	dc.l	$00030004, $48E76010, $4E6B240B, $48424202, $0C425D00, $661C342B, $00040242, $E000C2EB
	dc.l	$000ED441, $D440D440, $36823742, $0004504B, $36DB4CDF, $08064E75, $2F0B4E6B, $200B4840
	dc.l	$42000C40, $5D006612, $72003213, $02411FFF, $82EB000E, $20014840, $E248265F, $4E752F0B
	dc.l	$2F004E6B, $200B4840, $42000C40, $5D006616, $302B0004, $D06B000E, $02405FFF, $36803740
	dc.l	$0004504B, $36DB201F, $265F4E75, $2F0B2F00, $4E6B200B, $48404200, $0C405D00, $66043741
	dc.l	$000C201F, $265F4E75, $2F0B2F00, $4E6B200B, $48404200, $0C405D00, $6606504B, $36C136C1
	dc.l	$201F265F, $4E7561C4, $487AFF94, $48E77F12, $4E6B240B, $48424202, $0C425D00, $66282A1B
	dc.l	$2E1B4C93, $005C4846, $4DF900C0, $00002D45, $00044845, $72001218, $6E126B32, $4893001C
	dc.l	$484548E3, $05004CDF, $48FE4E75, $51CB0012, $D642DE86, $0887001D, $2D470004, $2A074845
	dc.l	$D2443C81, $54457200, $12186EE0, $67CE0241, $001E4EFB, $1002DE86, $721D0387, $6020602A
	dc.l	$602E6036, $603E1418, $60141818, $60D8603A, $1218D241, $76804843, $CE834841, $8E813602
	dc.l	$2D470004, $2A074845, $60BC0244, $9FFF60B6, $02449FFF, $00442000, $60AC0244, $9FFF0044
	dc.l	$400060A2, $00446000, $609C3F04, $1E98381F, $6094487A, $FECA2F0C, $49FA0016, $4FEFFFF0
	dc.l	$41D77E0E, $4EBAFCF4, $4FEF0010, $285F4E75, $42184447, $0647000F, $90C72F08, $4EBAFF0E
	dc.l	$205F7E0E, $4E75741E, $10181200, $E609C242, $3CB11000, $D000C042, $3CB10000, $51CCFFEA
	dc.l	$4E75487A, $00562F0C, $49FA0016, $4FEFFFF0, $41D77E0E, $4EBAFCA4, $4FEF0010, $285F4E75
	dc.l	$42184447, $0647000F, $90C72F08, $2F0D4BF9, $00C00004, $3E3C9E00, $60023A87, $1E186EFA
	dc.l	$67100407, $00E067F2, $0C070010, $6DEE5248, $60EA2A5F, $205F7E0E, $4E7533FC, $9E0000C0
	dc.l	$00044E75, $487AFFF4, $3F072F0D, $4BF900C0, $00043E3C, $9E006002, $3A871E18, $6EFA6710
	dc.l	$040700E0, $67F20C07, $00106DEE, $524860EA, $2A5F3E1F, $4E7546FC, $27004FEF, $FFF048E7
	dc.l	$FFFE47EF, $003C4EBA, $F5024EBA, $F3F04CDF, $7FFF487A, $F3CE2F2F, $00144E75, $48E7C456
	dc.l	$4E6B200B, $48404200, $0C405D00, $66124BF9, $00C00004, $4DEDFFFC, $43FAF558, $4EBAFCF4
	dc.l	$4CDF6A23, $4E7548E7, $C0D04E6B, $200B4840, $42000C40, $5D00660C, $3F3C0000, $610C610A
	dc.l	$67FC544F, $4CDF0B03, $4E756174, $41EF0004, $43F900A1, $00036178, $70F0C02F, $00054E75
	dc.l	$48E7FFFE, $3F3C0000, $61E04BF9, $00C00004, $4DEDFFFC, $61D467F2, $6B4041FA, $00765888
	dc.l	$D00064FA, $20106F32, $20404FEF, $FFF043FA, $F4E647D7, $2A3C4000, $00034EBA, $FC782ABC
	dc.l	$82308406, $2A85487A, $000C4850, $4CEF7FFF, $00164E75, $4FEF0010, $60B02ABA, $F47A60AA
	dc.l	$41F900C0, $000444D0, $6BFC44D0, $6AFC4E75, $12BC0000, $4E7172C0, $1011E508, $12BC0040
	dc.l	$4E71C001, $12110201, $003F8001, $46001210, $B10110C0, $C20010C1
	dc.w	$4E75
	dc.l	DEBUGGER__EXTENSIONS__BTN_A_DEBUGGER, DEBUGGER__EXTENSIONS__BTN_C_DEBUGGER, DEBUGGER__EXTENSIONS__BTN_B_DEBUGGER, $48E700FE, $41FA002A, $4EBAFD1C, $49D77C06, $3F3C2000
	dc.l	$2F3CE861, $303A41D7, $221C4EBA, $F32C522F, $000251CE, $FFF24FEF, $00224E75, $E0FA01F0
	dc.l	$26EA4164, $64726573, $73205265, $67697374, $6572733A, $E0E00000, $41FA0088, $4EBAFCD4
	dc.l	$22780000, $598945D7, $4EBAF284, $B3CA6570, $0C520040, $64642012, $67602040, $02400001
	dc.l	$66581220, $10200C00, $00616604, $4A01663A, $0C00004E, $660A0201, $00F80C01, $0090672A
	dc.l	$30200C40, $61006722, $12004200, $0C404E00, $66120C01, $00A8650C, $0C0100BB, $62060C01
	dc.l	$00B96606, $0C604EB9, $66102F0A, $2F092208, $4EBAF28A, $225F245F, $548A548A, $B3CA6490
	dc.l	$4E75E0FA, $01F026EA, $4261636B, $74726163, $653AE0E0
	dc.w	$0000

; ---------------------------------------------------------------
; MD Debugger's exported symbols
; ---------------------------------------------------------------

MDDBG__ErrorHandler: equ ErrorHandler+$0
MDDBG__Error_IdleLoop: equ ErrorHandler+$128
MDDBG__Error_InitConsole: equ ErrorHandler+$142
MDDBG__Error_MaskStackBoundaries: equ ErrorHandler+$14E
MDDBG__Error_DrawOffsetLocation: equ ErrorHandler+$1B8
MDDBG__Error_DrawOffsetLocation2: equ ErrorHandler+$1BC
MDDBG__Error_DrawOffsetLocation__inj: equ ErrorHandler+$1C2
MDDBG__ErrorHandler_SetupVDP: equ ErrorHandler+$250
MDDBG__ErrorHandler_VDPConfig: equ ErrorHandler+$286
MDDBG__ErrorHandler_VDPConfig_Nametables: equ ErrorHandler+$29C
MDDBG__ErrorHandler_ConsoleConfig_Initial: equ ErrorHandler+$2D8
MDDBG__ErrorHandler_ConsoleConfig_Shared: equ ErrorHandler+$2DC
MDDBG__Str_OffsetLocation_24bit: equ ErrorHandler+$30C
MDDBG__Str_OffsetLocation_32bit: equ ErrorHandler+$315
MDDBG__Art1bpp_Font: equ ErrorHandler+$350
MDDBG__GetSymbolByOffset: equ ErrorHandler+$64A
MDDBG__FormatString: equ ErrorHandler+$960
MDDBG__Console_Init: equ ErrorHandler+$A3A
MDDBG__Console_Reset: equ ErrorHandler+$A78
MDDBG__Console_InitShared: equ ErrorHandler+$A7A
MDDBG__Console_SetPosAsXY_Stack: equ ErrorHandler+$AC4
MDDBG__Console_SetPosAsXY: equ ErrorHandler+$ACA
MDDBG__Console_GetPosAsXY: equ ErrorHandler+$AFE
MDDBG__Console_StartNewLine: equ ErrorHandler+$B24
MDDBG__Console_SetBasePattern: equ ErrorHandler+$B52
MDDBG__Console_SetWidth: equ ErrorHandler+$B6E
MDDBG__Console_WriteLine_WithPattern: equ ErrorHandler+$B8C
MDDBG__Console_WriteLine: equ ErrorHandler+$B8E
MDDBG__Console_Write: equ ErrorHandler+$B92
MDDBG__Console_WriteLine_Formatted: equ ErrorHandler+$C58
MDDBG__Console_Write_Formatted: equ ErrorHandler+$C5C
MDDBG__Decomp1bpp: equ ErrorHandler+$C8C
MDDBG__KDebug_WriteLine_Formatted: equ ErrorHandler+$CA8
MDDBG__KDebug_Write_Formatted: equ ErrorHandler+$CAC
MDDBG__KDebug_FlushLine: equ ErrorHandler+$D00
MDDBG__KDebug_WriteLine: equ ErrorHandler+$D0A
MDDBG__KDebug_Write: equ ErrorHandler+$D0E
MDDBG__ErrorHandler_ConsoleOnly: equ ErrorHandler+$D3C
MDDBG__ErrorHandler_ClearConsole: equ ErrorHandler+$D62
MDDBG__ErrorHandler_PauseConsole: equ ErrorHandler+$D8C
MDDBG__ErrorHandler_PagesController: equ ErrorHandler+$DC6
MDDBG__VSync: equ ErrorHandler+$E26
MDDBG__ErrorHandler_ExtraDebuggerList: equ ErrorHandler+$E60
MDDBG__Debugger_AddressRegisters: equ ErrorHandler+$E6C
MDDBG__Debugger_Backtrace: equ ErrorHandler+$EB8

; ---------------------------------------------------------------
; WARNING!
;	DO NOT put any data from now on! DO NOT use ROM padding!
;	Symbol data should be appended here after ROM is compiled
;	by ConvSym utility, otherwise debugger modules won't be able
;	to resolve symbol names.
; ---------------------------------------------------------------
